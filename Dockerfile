# From the Kali linux base image
FROM kalilinux/kali-linux-docker

# Update and apt install programs
RUN apt-get update && apt-get upgrade -y && apt-get dist-upgrade -y && apt-get install -y \
 exploitdb \
 exploitdb-bin-sploits \
 git \
 gdb \
 gobuster \
 hashcat \
 hydra \
 man-db \
 minicom \
 nasm \
 nmap \
 sqlmap \
 sslscan \
 wordlists \
 python2.7 \
 python-pip \
 python-dev \
 libssl-dev \
 libffi-dev \
 build-essential

# Create known_hosts for git cloning
RUN mkdir -p /root/.ssh/
RUN touch /root/.ssh/known_hosts
# Add host keys
RUN ssh-keyscan bitbucket.org >> /root/.ssh/known_hosts
RUN ssh-keyscan github.com >> /root/.ssh/known_hosts

# Clone git repos
RUN git clone https://github.com/danielmiessler/SecLists.git /opt/seclists
RUN git clone https://github.com/PowerShellMafia/PowerSploit.git /opt/powersploit

# Other installs
RUN pip install --upgrade pip
RUN pip install pwntools

RUN wget -P /tmp https://dl.google.com/go/go1.12.7.linux-amd64.tar.gz
RUN tar -C /usr/local -xzf /tmp/go1.12.7.linux-amd64.tar.gz
RUN rm /tmp/go1.12.7.linux-amd64.tar.gz
ENV GOPATH /go
ENV PATH $GOPATH/bin:/usr/local/go/bin:$PATH
RUN mkdir -p "$GOPATH/src" "$GOPATH/bin" && chmod -R 777 "$GOPATH"

RUN git clone https://github.com/LukaSikic/subzy.git /opt/subzy
WORKDIR /opt/subzy/
RUN go get github.com/logrusorgru/aurora
RUN go build subzy.go
RUN cp subzy /usr/bin/
# Update ENV
ENV PATH=$PATH:/opt/powersploit

RUN go get github.com/OWASP/Amass; exit 0
ENV GO111MODULE on
WORKDIR /go/src/github.com/OWASP/Amass/
RUN go install ./...

# Set entrypoint and working directory
WORKDIR /root/